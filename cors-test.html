<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CORS Test</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 900px;
      margin: 50px auto;
      padding: 20px;
    }
    .test-section {
      border: 1px solid #ddd;
      padding: 20px;
      margin: 20px 0;
      border-radius: 8px;
    }
    .success {
      background-color: #d4edda;
      border-color: #c3e6cb;
      color: #155724;
    }
    .error {
      background-color: #f8d7da;
      border-color: #f5c6cb;
      color: #721c24;
    }
    .info {
      background-color: #d1ecf1;
      border-color: #bee5eb;
      color: #0c5460;
    }
    button {
      background-color: #007bff;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      margin: 5px;
    }
    button:hover {
      background-color: #0056b3;
    }
    pre {
      background-color: #f4f4f4;
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
    }
  </style>
</head>
<body>
  <h1>ğŸ” DigitalOcean Spaces CORS æµ‹è¯•</h1>
  
  <div class="test-section info">
    <h2>æµ‹è¯•æ–‡ä»¶</h2>
    <p><strong>URL:</strong> <code id="file-url">https://srs-tsport.sgp1.cdn.digitaloceanspaces.com/dvr/live/stream_7_68fa0d1b38d61/1761294005465.flv</code></p>
    <button onclick="testCORS()">ğŸ§ª æµ‹è¯• CORS</button>
    <button onclick="testWithFetch()">ğŸ“¡ æµ‹è¯• Fetch API</button>
    <button onclick="openFileInNewTab()">ğŸ”— åœ¨æ–°æ ‡ç­¾æ‰“å¼€</button>
  </div>

  <div id="results"></div>

  <div class="test-section">
    <h2>ğŸ“‹ é…ç½®CORSçš„æ­¥éª¤</h2>
    <ol>
      <li>ç™»å½• <a href="https://cloud.digitalocean.com/spaces" target="_blank">DigitalOcean Spacesæ§åˆ¶å°</a></li>
      <li>é€‰æ‹©ä½ çš„Space: <strong>srs-tsport</strong></li>
      <li>ç‚¹å‡» <strong>Settings</strong> æ ‡ç­¾</li>
      <li>æ‰¾åˆ° <strong>CORS Configurations</strong></li>
      <li>æ·»åŠ ä»¥ä¸‹é…ç½®:</li>
    </ol>
    <pre>{
  "AllowedOrigins": ["*"],
  "AllowedMethods": ["GET", "HEAD"],
  "AllowedHeaders": ["*"],
  "MaxAgeSeconds": 3600
}</pre>
  </div>

  <script>
    const fileUrl = 'https://srs-tsport.sgp1.cdn.digitaloceanspaces.com/dvr/live/stream_7_68fa0d1b38d61/1761294005465.flv';
    
    function showResult(title, message, type) {
      const resultsDiv = document.getElementById('results');
      const resultSection = document.createElement('div');
      resultSection.className = `test-section ${type}`;
      resultSection.innerHTML = `
        <h3>${title}</h3>
        <div>${message}</div>
      `;
      resultsDiv.appendChild(resultSection);
    }

    function clearResults() {
      document.getElementById('results').innerHTML = '';
    }

    async function testCORS() {
      clearResults();
      showResult('ğŸ§ª æµ‹è¯•å¼€å§‹', 'æ£€æŸ¥CORSé…ç½®...', 'info');

      try {
        const response = await fetch(fileUrl, {
          method: 'HEAD',
          mode: 'cors'
        });

        console.log('Response headers:', response.headers);
        
        const corsHeaders = {
          'access-control-allow-origin': response.headers.get('access-control-allow-origin'),
          'access-control-allow-methods': response.headers.get('access-control-allow-methods'),
          'access-control-allow-headers': response.headers.get('access-control-allow-headers')
        };

        console.log('CORS headers:', corsHeaders);

        if (corsHeaders['access-control-allow-origin']) {
          showResult(
            'âœ… CORSé…ç½®æ­£ç¡®',
            `
              <p><strong>Status:</strong> ${response.status} ${response.statusText}</p>
              <p><strong>Access-Control-Allow-Origin:</strong> ${corsHeaders['access-control-allow-origin']}</p>
              <p><strong>Access-Control-Allow-Methods:</strong> ${corsHeaders['access-control-allow-methods'] || 'N/A'}</p>
              <p><strong>Content-Type:</strong> ${response.headers.get('content-type')}</p>
              <p><strong>Content-Length:</strong> ${response.headers.get('content-length')} bytes</p>
              <p>æ–‡ä»¶åº”è¯¥å¯ä»¥æ­£å¸¸æ’­æ”¾ï¼</p>
            `,
            'success'
          );
        } else {
          showResult(
            'âš ï¸ æœªæ£€æµ‹åˆ°CORSå¤´',
            `
              <p><strong>Status:</strong> ${response.status}</p>
              <p>å“åº”æˆåŠŸï¼Œä½†æ²¡æœ‰CORSå¤´ã€‚è¿™å¯èƒ½å¯¼è‡´æµè§ˆå™¨é˜»æ­¢è®¿é—®ã€‚</p>
              <p>è¯·æŒ‰ç…§ä¸Šé¢çš„æ­¥éª¤é…ç½®CORSã€‚</p>
            `,
            'error'
          );
        }
      } catch (error) {
        console.error('CORS test error:', error);
        showResult(
          'âŒ CORSæµ‹è¯•å¤±è´¥',
          `
            <p><strong>é”™è¯¯:</strong> ${error.message}</p>
            <p>è¿™é€šå¸¸è¡¨ç¤ºCORSæœªé…ç½®æˆ–é…ç½®ä¸æ­£ç¡®ã€‚</p>
            <p><strong>å¯èƒ½çš„åŸå› :</strong></p>
            <ul>
              <li>CORSæœªåœ¨DigitalOcean Spacesé…ç½®</li>
              <li>æ–‡ä»¶ä¸å­˜åœ¨ (404)</li>
              <li>ç½‘ç»œè¿æ¥é—®é¢˜</li>
            </ul>
            <p><strong>è§£å†³æ–¹æ¡ˆ:</strong> è¯·æŒ‰ç…§ä¸Šé¢çš„æ­¥éª¤é…ç½®CORS</p>
          `,
          'error'
        );
      }
    }

    async function testWithFetch() {
      clearResults();
      showResult('ğŸ“¡ ä½¿ç”¨Fetch APIæµ‹è¯•', 'å°è¯•è·å–æ–‡ä»¶...', 'info');

      try {
        const response = await fetch(fileUrl);
        const blob = await response.blob();
        
        showResult(
          'âœ… FetchæˆåŠŸ',
          `
            <p><strong>Status:</strong> ${response.status}</p>
            <p><strong>æ–‡ä»¶å¤§å°:</strong> ${blob.size} bytes (${(blob.size / 1024 / 1024).toFixed(2)} MB)</p>
            <p><strong>ç±»å‹:</strong> ${blob.type}</p>
            <p>æ–‡ä»¶å¯ä»¥æˆåŠŸè·å–ï¼CORSé…ç½®æ­£ç¡®ã€‚</p>
          `,
          'success'
        );
      } catch (error) {
        showResult(
          'âŒ Fetchå¤±è´¥',
          `
            <p><strong>é”™è¯¯:</strong> ${error.message}</p>
            <p>æ— æ³•è·å–æ–‡ä»¶ã€‚è¯·æ£€æŸ¥CORSé…ç½®ã€‚</p>
          `,
          'error'
        );
      }
    }

    function openFileInNewTab() {
      window.open(fileUrl, '_blank');
      showResult(
        'â„¹ï¸ æ–°æ ‡ç­¾æ‰“å¼€',
        '<p>å¦‚æœæ–‡ä»¶å¯ä»¥ç›´æ¥åœ¨æµè§ˆå™¨æ‰“å¼€ï¼Œè¯´æ˜æ–‡ä»¶å­˜åœ¨ä¸”å¯è®¿é—®ã€‚</p><p>å¦‚æœçœ‹åˆ°ä¸‹è½½æç¤ºï¼Œè¿™æ˜¯æ­£å¸¸çš„FLVè¡Œä¸ºã€‚</p>',
        'info'
      );
    }

    // è‡ªåŠ¨è¿è¡Œæµ‹è¯•
    window.addEventListener('load', () => {
      console.log('Page loaded, click button to test CORS');
    });
  </script>
</body>
</html>
